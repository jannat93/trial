<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Sky ðŸŒŒ</title>
    <style>
        html, body {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background: black; color: white;
            font-family: sans-serif;
        }
        #camera-container { position: relative; width: 100%; height: 100%; }
        #camera { position: absolute; width: 100%; height: 100%; object-fit: cover; z-index: 0; display: none; }
        #overlay { position: absolute; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
        
        #controls {
            position: absolute; bottom: 15px; width: 100%; display: flex;
            justify-content: center; gap: 10px; z-index: 2;
        }
        button {
            padding: 12px 18px; font-size: 16px; border-radius: 8px;
            border: 1px solid white; background: rgba(0,0,0,0.7); color: white;
            cursor: pointer; transition: 0.3s;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5); /* Subtle neon glow for buttons */
        }
        button:hover { 
            background: rgba(255,255,255,0.2); 
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
        }

        #message {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            padding: 20px; background: rgba(0, 0, 0, 0.8); border: 2px solid cyan;
            border-radius: 10px; z-index: 3; text-align: center;
        }
    </style>
</head>
<body>
<div id="camera-container">
    <video id="camera" autoplay playsinline></video>
    <canvas id="overlay"></canvas>
    <!-- Element for displaying messages like camera errors -->
    <div id="message" style="display:none;"></div>
</div>
<div id="controls">
    <button id="startBtn">Start AR ðŸŒŒ</button>
    <button id="toggleBtn" style="display:none;">Toggle Deep Sky</button>
</div>

<script>
const video = document.getElementById("camera");
const canvas = document.getElementById("overlay");
const ctx = canvas.getContext("2d");
const startBtn = document.getElementById("startBtn");
const toggleBtn = document.getElementById("toggleBtn");
const messageBox = document.getElementById("message");

let showDeepSky = false;
let artificialObjects = [];
let showArtificialMilkyWay = false;

// --- UTILITY FUNCTIONS ---

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas(); // Initial call

/**
 * Displays a message to the user (instead of using alert()).
 * @param {string} msg 
 */
function showMessage(msg) {
    messageBox.textContent = msg;
    messageBox.style.display = "block";
    
    // Auto-hide the message after 5 seconds
    setTimeout(() => {
        messageBox.style.display = "none";
    }, 5000);
}


// --- AR DRAWING LOGIC ---

function drawSky() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Artificial Milky Way band (faint galactic glow)
    if (showArtificialMilkyWay) {
        let gradient = ctx.createLinearGradient(0, canvas.height*0.2, canvas.width, canvas.height*0.8);
        gradient.addColorStop(0,"rgba(255,255,255,0.03)");
        gradient.addColorStop(0.5,"rgba(200,200,255,0.15)");
        gradient.addColorStop(1,"rgba(255,255,255,0.03)");
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    // Artificial Moon + Stars (twinkling/pulsing)
    artificialObjects.forEach((o,i)=>{
        // Calculate pulse/twinkle effect based on time
        let pulse = 0.5 + 0.5 * Math.sin(Date.now()/500 + i); 
        let twinkleSize = o.size * (0.9 + 0.2 * pulse);
        let alpha = 0.7 + 0.3 * pulse;

        // Apply blur for glow effect
        ctx.shadowBlur = 25;
        ctx.shadowColor = o.color;
        
        ctx.beginPath();
        ctx.arc(o.x, o.y, twinkleSize, 0, Math.PI*2);
        // Update color alpha for twinkling effect
        ctx.fillStyle = o.color.replace(/[\d.]+\)$/g, alpha + ")"); 
        ctx.fill();
        
        // Clear shadow immediately to prevent it affecting the next object/frame
        ctx.shadowBlur = 0; 
    });

    requestAnimationFrame(drawSky);
}

drawSky(); // Start the animation loop


// --- EVENT HANDLERS ---

toggleBtn.addEventListener("click", () => {
    showDeepSky = !showDeepSky;
    toggleBtn.textContent = showDeepSky ? "Deep Sky On" : "Deep Sky Off";

    if (showDeepSky) {
        // Dramatic reveal after a delay (simulating processing/calibration)
        showMessage("Calibrating sensors... Revealing deep space in 10 seconds.");
        setTimeout(() => {
            artificialObjects = [
                { name: "Artificial Moon", x: canvas.width/2, y: canvas.height*0.3, size: 40, color: "rgba(240,240,255,0.95)" },
                // Reduced sizes for a more realistic, pinpoint look
                { name: "Star A", x: canvas.width*0.3, y: canvas.height*0.2, size: 3, color: "rgba(200,220,255,0.9)" },
                { name: "Star B", x: canvas.width*0.7, y: canvas.height*0.25, size: 2, color: "rgba(180,220,255,0.9)" },
                { name: "Star C", x: canvas.width*0.5, y: canvas.height*0.15, size: 2.5, color: "rgba(220,220,255,0.9)" }
            ];
            showArtificialMilkyWay = true;
            showMessage("Deep Space objects detected!");
        }, 10000);
    } else {
        artificialObjects = [];
        showArtificialMilkyWay = false;
        showMessage("Deep Sky view deactivated.");
    }
});

startBtn.addEventListener("click", async ()=>{
    try {
        // Request access to the environment (back) camera
        const stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});
        
        video.srcObject = stream;
        video.style.display = "block";

        // Hide start button and show AR control
        startBtn.style.display = "none";
        toggleBtn.style.display = "inline-block";

    } catch (e) {
        console.error("Camera access failed:", e);
        // Show user-friendly error message
        showMessage("Error: Camera access denied or not supported. Please allow camera permissions.");
        
        // Keep the start button visible so the user can retry
        startBtn.style.display = "inline-block"; 
    }
});
</script>
</body>
</html>
